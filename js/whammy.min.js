// Whammy.js by antimatter15
// https://github.com/antimatter15/whammy

var Whammy=function(){function e(e,n){var r=t(e);var i=3e4;var o=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:h(r.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:25541},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:r.width,id:176},{data:r.height,id:186}]}]}]}]}];var u=0;var a=0;while(u<e.length){var l=[];var c=0;do{l.push(e[u]);c+=e[u].duration;u++}while(u<e.length&&c<i);var p=0;var d={id:524531317,data:[{data:a,id:231}].concat(l.map(function(e){var t=f({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(p)});p+=e.duration;return{data:t,id:163}}))};o[1].data.push(d);a+=c}return s(o,n)}function t(e){var t=e[0].width,n=e[0].height,r=e[0].duration;for(var i=1;i<e.length;i++){if(e[i].width!=t)throw"Frame "+(i+1)+" has a different width";if(e[i].height!=n)throw"Frame "+(i+1)+" has a different height";if(e[i].duration<0||e[i].duration>32767)throw"Frame "+(i+1)+" has a weird duration (must be between 0 and 32767)";r+=e[i].duration}return{duration:r,width:t,height:n}}function n(e){var t=[];while(e>0){t.push(e&255);e=e>>8}return new Uint8Array(t.reverse())}function r(e){var t=new Uint8Array(e.length);for(var n=0;n<e.length;n++){t[n]=e.charCodeAt(n)}return t}function i(e){var t=[];var n=e.length%8?(new Array(1+8-e.length%8)).join("0"):"";e=n+e;for(var r=0;r<e.length;r+=8){t.push(parseInt(e.substr(r,8),2))}return new Uint8Array(t)}function s(e,t){var u=[];for(var a=0;a<e.length;a++){var f=e[a].data;if(typeof f=="object")f=s(f,t);if(typeof f=="number")f=i(f.toString(2));if(typeof f=="string")f=r(f);if(f.length){var l=l}var c=f.size||f.byteLength||f.length;var h=Math.ceil(Math.ceil(Math.log(c)/Math.log(2))/8);var p=c.toString(2);var d=(new Array(h*7+7+1-p.length)).join("0")+p;var v=(new Array(h)).join("0")+"1"+d;u.push(n(e[a].id));u.push(i(v));u.push(f)}if(t){var m=o(u);return new Uint8Array(m)}else{return new Blob(u,{type:"video/webm"})}}function o(e,t){if(t==null){t=[]}for(var n=0;n<e.length;n++){if(typeof e[n]=="object"){o(e[n],t)}else{t.push(e[n])}}return t}function u(e){var t="";var n=e.length%8?(new Array(1+8-e.length%8)).join("0"):"";e=n+e;for(var r=0;r<e.length;r+=8){t+=String.fromCharCode(parseInt(e.substr(r,8),2))}return t}function a(e){var t="";for(var n=0;n<e.length;n++){var r=e[n].data;if(typeof r=="object")r=a(r);if(typeof r=="number")r=u(r.toString(2));var i=r.length;var s=Math.ceil(Math.ceil(Math.log(i)/Math.log(2))/8);var o=i.toString(2);var f=(new Array(s*7+7+1-o.length)).join("0")+o;var l=(new Array(s)).join("0")+"1"+f;t+=u(e[n].id.toString(2))+u(l)+r}return t}function f(e){var t=0;if(e.keyframe)t|=128;if(e.invisible)t|=8;if(e.lacing)t|=e.lacing<<1;if(e.discardable)t|=1;if(e.trackNum>127){throw"TrackNumber > 127 not supported"}var n=[e.trackNum|128,e.timecode>>8,e.timecode&255,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame;return n}function l(e){var t=e.RIFF[0].WEBP[0];var n=t.indexOf("*");for(var r=0,i=[];r<4;r++)i[r]=t.charCodeAt(n+3+r);var s,o,u,a,f;f=i[1]<<8|i[0];s=f&16383;o=f>>14;f=i[3]<<8|i[2];u=f&16383;a=f>>14;return{width:s,height:u,data:t,riff:e}}function c(e){var t=0;var n={};while(t<e.length){var r=e.substr(t,4);var i=parseInt(e.substr(t+4,4).split("").map(function(e){var t=e.charCodeAt(0).toString(2);return(new Array(8-t.length+1)).join("0")+t}).join(""),2);var s=e.substr(t+4+4,i);t+=4+4+i;n[r]=n[r]||[];if(r=="RIFF"||r=="LIST"){n[r].push(c(s))}else{n[r].push(s)}}return n}function h(e){return[].slice.call(new Uint8Array((new Float64Array([e])).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")}function p(e,t){this.frames=[];this.duration=1e3/e;this.quality=t||.8}p.prototype.add=function(e,t){if(typeof t!="undefined"&&this.duration)throw"you can't pass a duration if the fps is set";if(typeof t=="undefined"&&!this.duration)throw"if you don't have the fps set, you ned to have durations here.";if("canvas"in e){e=e.canvas}if("toDataURL"in e){e=e.toDataURL("image/webp",this.quality)}else if(typeof e!="string"){throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string"}if(!/^data:image\/webp;base64,/ig.test(e)){throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp"}this.frames.push({image:e,duration:t||this.duration})};p.prototype.compile=function(t){return new e(this.frames.map(function(e){var t=l(c(atob(e.image.slice(23))));t.duration=e.duration;return t}),t)};return{Video:p,fromImageArray:function(t,n,r){return e(t.map(function(e){var t=l(c(atob(e.slice(23))));t.duration=1e3/n;return t}),r)},toWebM:e}}()